<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atsy - Seller Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/atsy-seller/styles.css">
</head>
<body>
    <!-- Navigation Sidebar -->
    <nav class="nav">
        <div class="nav-container">
            <a href="/atsy-seller/index.html" class="logo">Atsy</a>
            <div class="mobile-menu-btn" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="nav-links" id="navLinks">
                <a href="/atsy-seller/index.html" class="active">Dashboard</a>
                <a href="/atsy-seller/upload.html">Upload</a>
                <a href="/atsy-seller/orders.html">Orders</a>
                <a href="/atsy-seller/messages.html">Messages</a>
                <a href="/atsy-seller/insights.html">Insights</a>
                <div class="profile-icon">A</div>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Greeting -->
        <div class="greeting">
            <h1>Good morning, Amara</h1>
            <p>Lagos, Nigeria â€¢ Master Weaver</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="stats">
            <!-- Loaded by JavaScript -->
        </div>

        <!-- Quick Actions -->
        <div class="actions" style="display: flex; gap: 15px; margin: 30px 0;">
            <button class="btn btn-primary" onclick="location.href='/atsy-seller/upload.html'">Upload Product</button>
            <button class="btn btn-secondary" onclick="location.href='/atsy-seller/orders.html'">View Orders</button>
            <button class="btn btn-outline" onclick="location.href='/atsy-seller/insights.html'">Insights</button>
        </div>

        <!-- AI Suggestions -->
        <div class="card" style="margin-bottom: 30px;">
            <h3 style="margin-bottom: 20px; display: flex; align-items: center;">
                ðŸ¤– AI-Powered Suggestions
                <span class="ai-badge" style="margin-left: 10px;">AI</span>
            </h3>
            <div id="ai-suggestions">
                <!-- Loaded by JavaScript -->
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Recent Orders</h3>
                <a href="/atsy-seller/orders.html" style="color: var(--primary); text-decoration: none;">View all â†’</a>
            </div>
            <div id="recent-orders">
                <!-- Loaded by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://xoqyywycygofgbgazrpu.supabase.co/rest/v1';
        const API_KEY = 'sb_publishable_O-6kGt2-CDzg7uR8hQoK_w_ZD5M1aUo';

        function toggleMenu() {
            document.getElementById('navLinks').classList.toggle('active');
        }

        async function loadDashboard() {
            try {
                // Fetch dashboard data
                const response = await fetch(
                    `${API_BASE}/rpc/get_dashboard_summary?artisan_id_param=1`,
                    { headers: { 'apikey': API_KEY } }
                );
                const data = await response.json();
                
                // Update stats
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${data.artisan?.views || 1234}</div>
                        <div class="stat-label">Views</div>
                        <div class="stat-change">+12%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.artisan?.orders || 23}</div>
                        <div class="stat-label">Orders</div>
                        <div class="stat-change">+5</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">8</div>
                        <div class="stat-label">Messages</div>
                        <div class="stat-change">3 new</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">$${data.artisan?.earnings || 2450}</div>
                        <div class="stat-label">Earnings</div>
                        <div class="stat-change">+18%</div>
                    </div>
                `;

                // AI Suggestions
                document.getElementById('ai-suggestions').innerHTML = `
                    <div class="ai-suggestion">
                        <strong>Improve listing: Woven Basket Set</strong>
                        <span class="impact-badge">High Impact</span>
                        <p style="margin-top: 8px; color: var(--neutral);">Add more cultural context to increase buyer interest</p>
                    </div>
                    <div class="ai-suggestion">
                        <strong>Price recommendation</strong>
                        <span class="impact-badge" style="background: var(--warning);">Medium Impact</span>
                        <p style="margin-top: 8px; color: var(--neutral);">Your beaded necklaces are 15% below market average</p>
                    </div>
                    <div class="ai-suggestion">
                        <strong>Trending: Kente Cloth patterns</strong>
                        <span class="impact-badge">High Impact</span>
                        <p style="margin-top: 8px; color: var(--neutral);">Demand increased 45% this week in your category</p>
                    </div>
                `;

                // Recent Orders
                if (data.recent_orders && data.recent_orders.length > 0) {
                    document.getElementById('recent-orders').innerHTML = data.recent_orders.map(order => `
                        <div class="order-card" style="margin-bottom: 10px; padding: 15px;">
                            <div style="display: flex; align-items: center; width: 100%;">
                                <div style="flex: 1;">
                                    <strong>${order.product_title}</strong>
                                    <div style="color: var(--neutral); font-size: 14px;">Buyer: ${order.buyer}</div>
                                </div>
                                <div style="text-align: right; margin-right: 20px;">
                                    <div style="font-weight: 600; color: var(--primary);">$${order.amount}</div>
                                    <div style="font-size: 12px; color: var(--neutral);">${order.order_number}</div>
                                </div>
                                <span class="order-status status-${order.status.toLowerCase()}">${order.status}</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    // Demo orders if API returns none
                    document.getElementById('recent-orders').innerHTML = `
                        <div class="order-card" style="margin-bottom: 10px; padding: 15px;">
                            <div style="display: flex; align-items: center; width: 100%;">
                                <div style="flex: 1;">
                                    <strong>Hand-woven Basket Set</strong>
                                    <div style="color: var(--neutral); font-size: 14px;">Buyer: Sarah M.</div>
                                </div>
                                <div style="text-align: right; margin-right: 20px;">
                                    <div style="font-weight: 600; color: var(--primary);">$170</div>
                                    <div style="font-size: 12px; color: var(--neutral);">ORD-1234</div>
                                </div>
                                <span class="order-status status-processing">Processing</span>
                            </div>
                        </div>
                        <div class="order-card" style="padding: 15px;">
                            <div style="display: flex; align-items: center; width: 100%;">
                                <div style="flex: 1;">
                                    <strong>Traditional Beaded Necklace</strong>
                                    <div style="color: var(--neutral); font-size: 14px;">Buyer: John D.</div>
                                </div>
                                <div style="text-align: right; margin-right: 20px;">
                                    <div style="font-weight: 600; color: var(--primary);">$45</div>
                                    <div style="font-size: 12px; color: var(--neutral);">ORD-1233</div>
                                </div>
                                <span class="order-status status-shipped">Shipped</span>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading dashboard:', error);
                // Fallback to demo data
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">1,234</div>
                        <div class="stat-label">Views</div>
                        <div class="stat-change">+12%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">23</div>
                        <div class="stat-label">Orders</div>
                        <div class="stat-change">+5</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">8</div>
                        <div class="stat-label">Messages</div>
                        <div class="stat-change">3 new</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">$2,450</div>
                        <div class="stat-label">Earnings</div>
                        <div class="stat-change">+18%</div>
                    </div>
                `;
                
                document.getElementById('recent-orders').innerHTML = `
                    <div class="order-card" style="margin-bottom: 10px; padding: 15px;">
                        <div style="display: flex; align-items: center; width: 100%;">
                            <div style="flex: 1;">
                                <strong>Hand-woven Basket Set</strong>
                                <div style="color: var(--neutral); font-size: 14px;">Buyer: Sarah M.</div>
                            </div>
                            <div style="text-align: right; margin-right: 20px;">
                                <div style="font-weight: 600; color: var(--primary);">$170</div>
                                <div style="font-size: 12px; color: var(--neutral);">ORD-1234</div>
                            </div>
                            <span class="order-status status-processing">Processing</span>
                        </div>
                    </div>
                    <div class="order-card" style="padding: 15px;">
                        <div style="display: flex; align-items: center; width: 100%;">
                            <div style="flex: 1;">
                                <strong>Traditional Beaded Necklace</strong>
                                <div style="color: var(--neutral); font-size: 14px;">Buyer: John D.</div>
                            </div>
                            <div style="text-align: right; margin-right: 20px;">
                                <div style="font-weight: 600; color: var(--primary);">$45</div>
                                <div style="font-size: 12px; color: var(--neutral);">ORD-1233</div>
                            </div>
                            <span class="order-status status-shipped">Shipped</span>
                        </div>
                    </div>
                `;
            }
        }

        // Load dashboard when page loads
        loadDashboard();
    </script>
</body>
</html>