<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Atsy - Orders</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="index.html" class="logo">Atsy</a>
        <div class="mobile-menu-btn" onclick="toggleMenu()">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="nav-links" id="navLinks">
          <a href="index.html">Dashboard</a>
          <a href="upload.html">Upload</a>
          <a href="orders.html" class="active">Orders</a>
          <a href="messages.html">Messages</a>
          <a href="insights.html">Insights</a>
          <div class="profile-icon">A</div>
        </div>
      </div>
    </nav>

    <div class="container">
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 30px;
        "
      >
        <h1>Orders</h1>
        <span
          style="
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
          "
          >23 total orders</span
        >
      </div>

      <!-- Filter Tabs -->
      <div class="orders-filter">
        <button class="filter-btn active" onclick="filterOrders('all')">
          All
        </button>
        <button class="filter-btn" onclick="filterOrders('new')">New</button>
        <button class="filter-btn" onclick="filterOrders('processing')">
          Processing
        </button>
        <button class="filter-btn" onclick="filterOrders('shipped')">
          Shipped
        </button>
        <button class="filter-btn" onclick="filterOrders('completed')">
          Completed
        </button>
      </div>

      <!-- Orders List -->
      <div id="orders-list">
        <!-- Loaded by JavaScript -->
      </div>
    </div>

    <script src="script.js"></script>
    <script>
      let allOrders = [];

      async function loadOrders() {
        showLoading('orders-list');

        try {
          const response = await fetch(
            `${API_BASE}/orders?order=created_at.desc`,
            { headers: { apikey: API_KEY } }
          );
          const orders = await response.json();

          if (orders.length > 0) {
            allOrders = orders;
            displayOrders(orders);
          } else {
            loadDemoOrders();
          }
        } catch (error) {
          console.error('Error loading orders:', error);
          loadDemoOrders();
        }
      }

      function loadDemoOrders() {
        allOrders = [
          {
            order_number: 'ORD-1234',
            product: 'Hand-woven Basket Set',
            buyer_name: 'Sarah Mitchell',
            quantity: 2,
            total_amount: 170,
            status: 'Processing',
            created_at: '2026-02-18',
            product_image: 'https://via.placeholder.com/80x80?text=Basket',
          },
          {
            order_number: 'ORD-1233',
            product: 'Traditional Beaded Necklace',
            buyer_name: 'John Davidson',
            quantity: 1,
            total_amount: 45,
            status: 'Shipped',
            created_at: '2026-02-17',
            product_image: 'https://via.placeholder.com/80x80?text=Necklace',
          },
          {
            order_number: 'ORD-1232',
            product: 'Handcrafted Ceramic Bowl',
            buyer_name: 'Maria Lopez',
            quantity: 1,
            total_amount: 120,
            status: 'Completed',
            created_at: '2026-02-15',
            product_image: 'https://via.placeholder.com/80x80?text=Ceramic',
          },
          {
            order_number: 'ORD-1231',
            product: 'Kente Cloth Textile',
            buyer_name: 'James Cooper',
            quantity: 1,
            total_amount: 250,
            status: 'Completed',
            created_at: '2026-02-10',
            product_image: 'https://via.placeholder.com/80x80?text=Kente',
          },
        ];
        displayOrders(allOrders);
      }

      function displayOrders(orders) {
        const container = document.getElementById('orders-list');

        if (orders.length === 0) {
          container.innerHTML = `
                    <div class="card" style="text-align: center; padding: 60px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ðŸ“¦</div>
                        <h3>No orders found</h3>
                        <p style="color: var(--neutral); margin: 10px 0;">When you receive orders, they'll appear here</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = orders
          .map(
            (order) => `
                <div class="order-card">
                    <img src="${
                      order.product_image ||
                      'https://via.placeholder.com/80x80?text=Product'
                    }" alt="${order.product}" class="order-image">
                    <div class="order-details">
                        <div class="order-title">${
                          order.product || order.product_title || 'Hand-woven Basket Set'
                        }</div>
                        <div class="order-meta">
                            <span>Order #${order.order_number}</span>
                            <span>${formatDate(order.created_at)}</span>
                            <span>Qty: ${order.quantity || 1}</span>
                        </div>
                        <div style="margin-top: 8px;">
                            <strong>Buyer:</strong> ${order.buyer_name}
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 20px; font-weight: 600; color: var(--primary); margin-bottom: 10px;">
                            $${order.total_amount}
                        </div>
                        <span class="order-status status-${order.status.toLowerCase()}">${
              order.status
            }</span>
                    </div>
                </div>
            `
          )
          .join('');
      }

      function filterOrders(status) {
        // Update active button
        document.querySelectorAll('.filter-btn').forEach((btn) => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');

        // Filter orders
        if (status === 'all') {
          displayOrders(allOrders);
        } else {
          const filtered = allOrders.filter(
            (order) => order.status.toLowerCase() === status.toLowerCase()
          );
          displayOrders(filtered);
        }
      }

      function formatDate(dateString) {
        const options = { month: 'short', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
      }

      loadOrders();
    </script>
  </body>
</html>
